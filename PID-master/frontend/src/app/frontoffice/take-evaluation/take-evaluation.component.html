<div class="take-evaluation">
  <div class="eval-header" *ngIf="evaluation">
    <h1>{{ evaluation.title }}</h1>
    <p class="subtitle">Question {{ currentIndex + 1 }} of {{ questions.length }}</p>
    <mat-progress-bar mode="determinate" [value]="progress" class="progress-bar"></mat-progress-bar>
  </div>

  <div class="question-card" *ngIf="currentQuestion && !loading">
    <div class="q-header">
      <span class="q-type">{{ currentQuestion.questionType }}</span>
      <span class="q-points">{{ currentQuestion.points }} pts</span>
    </div>
    <p class="q-text">{{ currentQuestion.questionText }}</p>

    <!-- MCQ -->
    <div class="options-list" *ngIf="currentQuestion.questionType === 'MCQ' && currentQuestion.options">
      <button mat-stroked-button class="option-btn" *ngFor="let opt of currentQuestion.options"
        [class.selected]="isSelectedMCQ(opt)" (click)="selectOptionMCQ(opt)">
        <mat-icon>{{ isSelectedMCQ(opt) ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
        {{ opt.optionText }}
      </button>
    </div>

    <!-- MSQ -->
    <div class="options-list" *ngIf="currentQuestion.questionType === 'MSQ' && currentQuestion.options">
      <button mat-stroked-button class="option-btn" *ngFor="let opt of currentQuestion.options"
        [class.selected]="isSelectedMSQ(opt)" (click)="toggleOptionMSQ(opt)">
        <mat-icon>{{ isSelectedMSQ(opt) ? 'check_box' : 'check_box_outline_blank' }}</mat-icon>
        {{ opt.optionText }}
      </button>
    </div>

    <!-- FILL_BLANK -->
    <div class="text-answer" *ngIf="currentQuestion.questionType === 'FILL_BLANK'">
      <p class="paragraph" *ngIf="currentQuestion.paragraphText">{{ currentQuestion.paragraphText }}</p>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Your answer (comma-separated for multiple blanks)</mat-label>
        <input matInput [ngModel]="getAnswerText()" (ngModelChange)="setAnswerText($event)" placeholder="e.g. Paris,Rome">
      </mat-form-field>
    </div>

    <!-- READING / WRITING -->
    <div class="text-answer" *ngIf="currentQuestion.questionType === 'READING' || currentQuestion.questionType === 'WRITING'">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Your answer</mat-label>
        <textarea matInput rows="6" [ngModel]="getAnswerText()" (ngModelChange)="setAnswerText($event)" placeholder="Type your answer here..."></textarea>
      </mat-form-field>
    </div>

    <div class="actions">
      <button mat-stroked-button (click)="prev()" [disabled]="currentIndex === 0">
        <mat-icon>arrow_back</mat-icon> Previous
      </button>
      <button mat-raised-button class="submit-btn" (click)="submitCurrent()" [disabled]="submitting || finishing">
        <mat-icon>{{ currentIndex < questions.length - 1 ? 'arrow_forward' : 'check_circle' }}</mat-icon>
        {{ currentIndex < questions.length - 1 ? 'Next' : 'Finish & Submit' }}
      </button>
    </div>
  </div>

  <div class="loading-state" *ngIf="loading">
    <mat-icon class="spin">refresh</mat-icon>
    <p>Loading...</p>
  </div>
</div>
